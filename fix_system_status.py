#!/usr/bin/env python3\n# -*- coding: utf-8 -*-\n\"\"\"\nä¿®å¤ç³»ç»ŸçŠ¶æ€æ•°æ®åº“è®°å½•\nç¡®ä¿çŠ¶æ€æ­£ç¡®åæ˜ å®é™…è¿è¡Œæƒ…å†µ\n\"\"\"\n\nimport psycopg2\nfrom datetime import datetime\nimport json\n\ndef fix_system_status():\n    \"\"\"ä¿®å¤ç³»ç»ŸçŠ¶æ€è®°å½•\"\"\"\n    try:\n        # è¿æ¥PostgreSQLæ•°æ®åº“\n        conn = psycopg2.connect(\n            host=\"localhost\",\n            database=\"quantitative\",\n            user=\"quant_user\",\n            password=\"quant_password\",\n            port=\"5432\"\n        )\n        \n        cursor = conn.cursor()\n        \n        print(\"ğŸ”§ å¼€å§‹ä¿®å¤ç³»ç»ŸçŠ¶æ€...\")\n        \n        # 1. æŸ¥è¯¢å½“å‰ç­–ç•¥æ•°é‡\n        cursor.execute(\"SELECT COUNT(*) FROM strategies\")\n        total_strategies = cursor.fetchone()[0]\n        \n        cursor.execute(\"SELECT COUNT(*) FROM strategies WHERE enabled = true\")\n        running_strategies = cursor.fetchone()[0]\n        \n        cursor.execute(\"SELECT COUNT(*) FROM strategies WHERE final_score >= 65\")\n        selected_strategies = cursor.fetchone()[0]\n        \n        print(f\"ğŸ“Š ç­–ç•¥ç»Ÿè®¡: æ€»æ•°={total_strategies}, è¿è¡Œ={running_strategies}, ç²¾é€‰={selected_strategies}\")\n        \n        # 2. æ›´æ–°ç³»ç»ŸçŠ¶æ€è®°å½•\n        cursor.execute(\"\"\"\n            INSERT INTO system_status \n            (id, quantitative_running, auto_trading_enabled, total_strategies, \n             running_strategies, selected_strategies, current_generation, \n             evolution_enabled, last_evolution_time, last_update_time, \n             system_health, notes)\n            VALUES (1, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)\n            ON CONFLICT (id) DO UPDATE SET\n                quantitative_running = EXCLUDED.quantitative_running,\n                auto_trading_enabled = EXCLUDED.auto_trading_enabled,\n                total_strategies = EXCLUDED.total_strategies,\n                running_strategies = EXCLUDED.running_strategies,\n                selected_strategies = EXCLUDED.selected_strategies,\n                current_generation = EXCLUDED.current_generation,\n                evolution_enabled = EXCLUDED.evolution_enabled,\n                last_evolution_time = EXCLUDED.last_evolution_time,\n                last_update_time = EXCLUDED.last_update_time,\n                system_health = EXCLUDED.system_health,\n                notes = EXCLUDED.notes\n        \"\"\", (\n            True,  # quantitative_running\n            True,  # auto_trading_enabled\n            total_strategies,\n            running_strategies,\n            selected_strategies,\n            1,     # current_generation\n            True,  # evolution_enabled\n            datetime.now(),  # last_evolution_time\n            datetime.now(),  # last_update_time\n            'online',  # system_health\n            'ç³»ç»Ÿæ­£å¸¸è¿è¡Œï¼Œè¿›åŒ–å¼•æ“æ´»è·ƒ'  # notes\n        ))\n        \n        conn.commit()\n        \n        # 3. éªŒè¯æ›´æ–°ç»“æœ\n        cursor.execute(\"\"\"\n            SELECT quantitative_running, auto_trading_enabled, total_strategies,\n                   running_strategies, selected_strategies, system_health\n            FROM system_status WHERE id = 1\n        \"\"\")\n        \n        result = cursor.fetchone()\n        if result:\n            print(\"âœ… ç³»ç»ŸçŠ¶æ€å·²æ›´æ–°:\")\n            print(f\"   é‡åŒ–ç³»ç»Ÿè¿è¡Œ: {result[0]}\")\n            print(f\"   è‡ªåŠ¨äº¤æ˜“å¯ç”¨: {result[1]}\")\n            print(f\"   ç­–ç•¥æ€»æ•°: {result[2]}\")\n            print(f\"   è¿è¡Œç­–ç•¥: {result[3]}\")\n            print(f\"   ç²¾é€‰ç­–ç•¥: {result[4]}\")\n            print(f\"   ç³»ç»Ÿå¥åº·: {result[5]}\")\n        \n        cursor.close()\n        conn.close()\n        \n        print(\"ğŸ¯ ç³»ç»ŸçŠ¶æ€ä¿®å¤å®Œæˆï¼\")\n        return True\n        \n    except Exception as e:\n        print(f\"âŒ ä¿®å¤ç³»ç»ŸçŠ¶æ€å¤±è´¥: {e}\")\n        return False\n\nif __name__ == \"__main__\":\n    fix_system_status() 