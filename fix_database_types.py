#!/usr/bin/env python3\n# -*- coding: utf-8 -*-\n\"\"\"\n数据库字段类型修复脚本\n修复PostgreSQL中的字段类型问题\n\"\"\"\n\nimport psycopg2\n\ndef fix_database_types():\n    conn = psycopg2.connect(\n        host='localhost',\n        database='quantitative',\n        user='quant_user',\n        password='chenfei0421'\n    )\n    conn.autocommit = True\n    cursor = conn.cursor()\n    \n    print(\"🔧 修复数据库字段类型...\")\n    \n    try:\n        # 1. 修复 trading_signals 表的 executed 字段\n        cursor.execute(\"\"\"\n            ALTER TABLE trading_signals \n            ALTER COLUMN executed TYPE boolean \n            USING executed::boolean\n        \"\"\")\n        print(\"✅ trading_signals.executed 字段类型已修复为 boolean\")\n        \n    except Exception as e:\n        print(f\"⚠️ 修复 trading_signals.executed 失败: {e}\")\n    \n    try:\n        # 2. 检查其他可能的类型问题\n        cursor.execute(\"\"\"\n            SELECT column_name, data_type \n            FROM information_schema.columns \n            WHERE table_name = 'trading_signals'\n        \"\"\")\n        \n        columns = cursor.fetchall()\n        print(\"\\n📊 trading_signals 表结构:\")\n        for col, dtype in columns:\n            print(f\"   {col}: {dtype}\")\n            \n    except Exception as e:\n        print(f\"⚠️ 检查表结构失败: {e}\")\n    \n    try:\n        # 3. 修复 strategy_trade_logs 中可能的字段问题\n        cursor.execute(\"\"\"\n            SELECT column_name, data_type \n            FROM information_schema.columns \n            WHERE table_name = 'strategy_trade_logs'\n            AND column_name IN ('executed', 'is_real_money')\n        \"\"\")\n        \n        trade_columns = cursor.fetchall()\n        print(\"\\n📊 strategy_trade_logs 相关字段:\")\n        for col, dtype in trade_columns:\n            print(f\"   {col}: {dtype}\")\n            \n    except Exception as e:\n        print(f\"⚠️ 检查交易日志表失败: {e}\")\n    \n    conn.close()\n    print(\"\\n✅ 数据库类型修复完成\")\n\nif __name__ == \"__main__\":\n    fix_database_types() 