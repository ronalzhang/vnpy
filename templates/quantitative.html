<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>校长的量化系统 - 量化交易</title>
    <!-- 添加favicon -->
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/logo.png') }}">
    <!-- 替换为更稳定的CDN -->
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.2.3/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.3.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <!-- 引用量化交易专用样式 -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/quantitative.css') }}">
    <script src="https://cdn.bootcdn.net/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
</head>
<body class="quantitative-page">
    <!-- 重新设计的导航栏 -->
    <header>
        <nav class="navbar navbar-expand-lg">
            <div class="container-fluid px-4">
                <div class="navbar-content w-100 d-flex justify-content-between align-items-center">
                    <!-- 左侧：品牌名和系统状态 -->
                    <div class="navbar-left d-flex align-items-center">
                        <a class="navbar-brand me-4" href="/">
                            <i class="fas fa-chart-line me-2"></i>
                            校长的量化系统
                        </a>
                        <div class="system-status d-flex align-items-center">
                            <span class="status-dot offline" id="system-status-indicator"></span>
                            <span id="system-status-text" class="me-3">离线</span>
                            <small id="current-time" class="text-white-50">2025/7/1 09:05:27</small>
                        </div>
                    </div>
                    
                    <!-- 右侧：导航菜单 -->
                    <ul class="navbar-nav d-flex flex-row">
                        <li class="nav-item me-3">
                            <a class="nav-link" href="/">
                                <i class="fas fa-home me-1"></i>
                                <span class="d-none d-md-inline">市场数据</span>
                            </a>
                        </li>
                        <li class="nav-item me-3">
                            <a class="nav-link active" href="/quantitative.html">
                                <i class="fas fa-robot me-1"></i>
                                <span class="d-none d-md-inline">量化交易</span>
                            </a>
                        </li>
                        <li class="nav-item me-3">
                            <a class="nav-link" href="/arbitrage.html">
                                <i class="fas fa-exchange-alt me-1"></i>
                                <span class="d-none d-md-inline">套利系统</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/operations-log.html">
                                <i class="fas fa-list-alt me-1"></i>
                                <span class="d-none d-md-inline">日志</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <!-- 主要内容区域 - 采用更紧凑的布局 -->
    <div class="container-fluid px-4 py-3">
        
        <!-- 策略进化实时监控 - 优化为更紧凑的显示 -->
        <div class="row mb-3">
            <div class="col-12">
                <div class="card border-0">
                    <div class="card-header d-flex justify-content-between align-items-center py-3">
                        <h6 class="mb-0 d-flex align-items-center">
                            <i class="fas fa-chart-line me-2 text-primary"></i>
                            策略进化实时监控
                        </h6>
                        <div class="d-flex align-items-center">
                            <span class="badge me-2" id="evolutionLogCount">0 条记录</span>
                            <button class="btn btn-sm btn-outline-primary" onclick="showAllLogs()">
                                <i class="fas fa-list me-1"></i>查看全部
                            </button>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <!-- 进化日志滚动显示 -->
                        <div class="evolution-ticker-container" style="height: 100px;">
                            <div class="evolution-ticker" id="evolutionTicker">
                                <div class="ticker-item">
                                    <span class="text-muted">正在加载策略进化日志...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 核心控制面板 - 采用4列布局更紧凑 -->
        <div class="row mb-3">
            <!-- 系统控制台 -->
            <div class="col-xl-3 col-lg-6 mb-3">
                <div class="card system-control-card h-100">
                    <div class="card-body p-3">
                        <h6 class="card-title mb-3 d-flex align-items-center">
                            <i class="fas fa-cog me-2"></i> 系统控制
                        </h6>
                        
                        <!-- 控制项目 -->
                        <div class="control-items">
                            <div class="control-item d-flex justify-content-between align-items-center mb-2">
                                <div class="d-flex align-items-center">
                                    <span class="status-dot offline me-2" id="systemStatusDot"></span>
                                    <small>系统状态</small>
                                </div>
                                <span class="badge" id="systemStatusBadge">离线</span>
                            </div>
                            
                            <div class="control-item d-flex justify-content-between align-items-center mb-2">
                                <small>量化系统</small>
                                <button id="systemToggle" class="btn-toggle" onclick="toggleSystem()"></button>
                            </div>
                            
                            <div class="control-item d-flex justify-content-between align-items-center mb-2">
                                <small>真实交易</small>
                                <button id="autoTradingToggle" class="btn-toggle" onclick="toggleAutoTrading()"></button>
                            </div>
                            
                            <div class="control-item d-flex justify-content-between align-items-center">
                                <small>策略管理</small>
                                <button class="btn btn-sm btn-outline-primary" onclick="showStrategyManagement()">
                                    <i class="fas fa-cogs"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 账户总览 -->
            <div class="col-xl-3 col-lg-6 mb-3">
                <div class="card account-card h-100">
                    <div class="card-body p-3">
                        <h6 class="card-title mb-3 d-flex align-items-center">
                            <i class="fas fa-wallet me-2"></i> 账户总览
                        </h6>
                        
                        <div class="account-metrics">
                            <div class="metric-row d-flex justify-content-between mb-2">
                                <small class="text-muted">总资产</small>
                                <span class="fw-bold" id="totalBalance">-</span>
                            </div>
                            <div class="metric-row d-flex justify-content-between mb-2">
                                <small class="text-muted">今日盈亏</small>
                                <span class="fw-bold text-success" id="dailyPnl">-</span>
                            </div>
                            <div class="metric-row d-flex justify-content-between mb-2">
                                <small class="text-muted">今日收益率</small>
                                <span class="fw-bold" id="dailyReturn">-</span>
                            </div>
                            <div class="metric-row d-flex justify-content-between">
                                <small class="text-muted">今日交易</small>
                                <span class="fw-bold" id="dailyTrades">-</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 交易所状态 -->
            <div class="col-xl-3 col-lg-6 mb-3">
                <div class="card exchange-card h-100">
                    <div class="card-body p-3">
                        <h6 class="card-title mb-3 d-flex align-items-center">
                            <i class="fas fa-link me-2"></i> 交易所状态
                        </h6>
                        
                        <div id="exchangeStatus">
                            <div class="exchange-item d-flex justify-content-between align-items-center mb-2">
                                <div class="d-flex align-items-center">
                                    <span class="status-dot online me-2"></span>
                                    <small>币安</small>
                                </div>
                                <small class="text-success">25ms</small>
                            </div>
                            <div class="exchange-item d-flex justify-content-between align-items-center mb-2">
                                <small class="text-muted">API权限</small>
                                <span class="badge bg-success">现货</span>
                            </div>
                            <div class="exchange-item d-flex justify-content-between align-items-center">
                                <small class="text-muted">最后更新</small>
                                <small id="lastUpdate">刚刚</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 性能监控 -->
            <div class="col-xl-3 col-lg-6 mb-3">
                <div class="card h-100">
                    <div class="card-body p-3">
                        <h6 class="card-title mb-3 d-flex align-items-center">
                            <i class="fas fa-tachometer-alt me-2"></i> 性能监控
                        </h6>
                        
                        <div class="performance-metrics">
                            <div class="metric-row d-flex justify-content-between mb-2">
                                <small class="text-muted">活跃策略</small>
                                <span class="fw-bold text-primary" id="activeStrategies">-</span>
                            </div>
                            <div class="metric-row d-flex justify-content-between mb-2">
                                <small class="text-muted">胜率</small>
                                <span class="fw-bold text-success" id="winRate">-</span>
                            </div>
                            <div class="metric-row d-flex justify-content-between mb-2">
                                <small class="text-muted">最大回撤</small>
                                <span class="fw-bold text-warning" id="maxDrawdown">-</span>
                            </div>
                            <div class="metric-row d-flex justify-content-between">
                                <small class="text-muted">夏普比率</small>
                                <span class="fw-bold" id="sharpeRatio">-</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 实时图表和监控 - 一行三列显示 -->
        <div class="row mb-3">
            <!-- 收益曲线 -->
            <div class="col-lg-4 mb-3">
                <div class="card h-100">
                    <div class="card-header py-2">
                        <h6 class="mb-0 d-flex align-items-center">
                            <i class="fas fa-chart-line me-2"></i> 收益曲线
                        </h6>
                    </div>
                    <div class="card-body p-2">
                        <div class="performance-chart" style="height: 250px;">
                            <canvas id="performanceChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 资产增长 -->
            <div class="col-lg-4 mb-3">
                <div class="card h-100">
                    <div class="card-header py-2 d-flex justify-content-between align-items-center">
                        <h6 class="mb-0 d-flex align-items-center">
                            <i class="fas fa-chart-area me-2"></i> 资产增长
                        </h6>
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-outline-primary btn-sm" onclick="toggleBalanceChart('7')">7天</button>
                            <button class="btn btn-outline-primary btn-sm active" onclick="toggleBalanceChart('30')">30天</button>
                        </div>
                    </div>
                    <div class="card-body p-2">
                        <div class="balance-chart" style="height: 200px;">
                            <canvas id="balanceChart"></canvas>
                        </div>
                        
                        <!-- 里程碑展示 - 更紧凑 -->
                        <div class="milestones mt-2">
                            <div class="row g-2 text-center">
                                <div class="col-4">
                                    <div class="milestone-item p-2">
                                        <div class="milestone-value text-success small">10U</div>
                                        <div class="milestone-label">起始</div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="milestone-item p-2">
                                        <div class="milestone-value text-warning small" id="currentBalance">9.7U</div>
                                        <div class="milestone-label">当前</div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="milestone-item p-2">
                                        <div class="milestone-value text-primary small">100K</div>
                                        <div class="milestone-label">目标</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 最新信号 -->
            <div class="col-lg-4 mb-3">
                <div class="card h-100">
                    <div class="card-header py-2">
                        <h6 class="mb-0 d-flex align-items-center">
                            <i class="fas fa-signal me-2"></i> 最新信号
                        </h6>
                    </div>
                    <div class="card-body p-2">
                        <div class="signals-list" style="max-height: 250px; overflow-y: auto;">
                            <div id="signalsContainer">
                                <div class="text-center text-muted py-3">
                                    <small>暂无交易信号</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 策略管理 - 占满整个浏览器宽度 -->
        <div class="row">
            <div class="col-12 mb-3">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center py-3">
                        <h6 class="mb-0 d-flex align-items-center">
                            <i class="fas fa-brain me-2"></i> 量化策略管理
                        </h6>
                        <div class="d-flex align-items-center">
                            <button class="btn btn-sm btn-outline-primary" onclick="showAllLogs()">
                                <i class="fas fa-list me-1"></i>滚动日志
                            </button>
                        </div>
                    </div>
                    <div class="card-body p-3">
                        <div class="row" id="strategiesContainer">
                            <!-- 策略卡片将通过JavaScript动态生成 -->
                            <div class="col-12">
                                <div class="alert alert-info mb-0" id="jsTestStatus">
                                    <i class="fas fa-spinner fa-spin me-2"></i>正在加载策略数据...
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 策略配置弹窗模态框 -->
    <div class="modal fade" id="strategyConfigModal" tabindex="-1" aria-labelledby="strategyConfigModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="strategyConfigModalLabel">
                        <i class="fas fa-cog"></i> 策略配置
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="strategyConfigForm">
                        <input type="hidden" id="strategyId" name="strategyId">
                        
                        <!-- 基本信息 -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="strategyName" class="form-label">策略名称</label>
                                <input type="text" class="form-control" id="strategyName" name="strategyName" required>
                            </div>
                            <div class="col-md-6">
                                <label for="strategySymbol" class="form-label">交易对</label>
                                <select class="form-select" id="strategySymbol" name="strategySymbol" required>
                                    <option value="BTC/USDT">BTC/USDT</option>
                                    <option value="ETH/USDT">ETH/USDT</option>
                                    <option value="ADA/USDT">ADA/USDT</option>
                                    <option value="SOL/USDT">SOL/USDT</option>
                                    <option value="DOGE/USDT">DOGE/USDT</option>
                                    <option value="XRP/USDT">XRP/USDT</option>
                                </select>
                            </div>
                        </div>

                        <!-- 策略类型 -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="strategyType" class="form-label">策略类型</label>
                                <select class="form-select" id="strategyType" name="strategyType" disabled>
                                    <option value="momentum">动量策略</option>
                                    <option value="mean_reversion">均值回归</option>
                                    <option value="breakout">突破策略</option>
                                    <option value="grid_trading">网格交易</option>
                                    <option value="high_frequency">高频交易</option>
                                    <option value="trend_following">趋势跟踪</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="strategyEnabled" class="form-label">策略状态</label>
                                <div class="form-check form-switch mt-2">
                                    <input class="form-check-input" type="checkbox" role="switch" id="strategyEnabled" name="strategyEnabled">
                                    <label class="form-check-label" for="strategyEnabled">启用策略</label>
                                </div>
                            </div>
                        </div>

                        <!-- 策略参数 -->
                        <div class="card mb-3">
                            <div class="card-header">
                                <h6 class="mb-0">策略参数</h6>
                            </div>
                            <div class="card-body">
                                <div id="strategyParameters">
                                    <!-- 动态参数表单将在这里生成 -->
                                </div>
                            </div>
                        </div>

                        <!-- 策略统计 -->
                        <div class="card mb-3">
                            <div class="card-header">
                                <h6 class="mb-0">策略统计</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="text-center">
                                            <div class="h5 mb-1" id="strategyTotalReturn">-</div>
                                            <small class="text-muted">总收益率</small>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="text-center">
                                            <div class="h5 mb-1" id="strategyWinRate">-</div>
                                            <small class="text-muted">成功率</small>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="text-center">
                                            <div class="h5 mb-1" id="strategyTotalTrades">-</div>
                                            <small class="text-muted">交易次数</small>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="text-center">
                                            <div class="h5 mb-1" id="strategyDailyReturn">-</div>
                                            <small class="text-muted">日收益率</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="saveStrategyConfig">保存配置</button>
                    <button type="button" class="btn btn-warning" id="resetStrategyParams">重置参数</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 策略日志弹窗 -->
    <div class="modal fade" id="strategyLogsModal" tabindex="-1" aria-labelledby="strategyLogsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="strategyLogsModalLabel">
                        <i class="fas fa-history"></i> 策略日志
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- 🔥 新增：多标签页策略日志结构 -->
                    <div id="strategyLogTabs">
                        <!-- 标签页内容将由JavaScript动态生成 -->
                        <div class="text-center p-4">
                            <i class="fas fa-spinner fa-spin fa-2x text-primary mb-3"></i>
                            <p class="text-muted">正在初始化日志标签页...</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-info" id="exportLogs">导出日志</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 策略管理配置弹窗 -->
    <div class="modal fade" id="strategyManagementModal" tabindex="-1" aria-labelledby="strategyManagementModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="strategyManagementModalLabel">
                        <i class="fas fa-cogs"></i> 策略管理配置
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="strategyManagementForm">
                        <!-- 策略运行状态仪表盘 -->
                        <div class="card mb-3">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="fas fa-chart-pie"></i> 策略运行状态
                                </h6>
                            </div>
                            <div class="card-body">
                                <!-- 简化的状态显示，移除复杂配置 -->
                                        <div class="row text-center">
                                            <div class="col-md-3">
                                                <div class="metric-value" id="currentActiveStrategies">-</div>
                                                <div class="metric-label">活跃策略</div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="metric-value text-success" id="realTradingStrategiesCount">-</div>
                                                <div class="metric-label">真实交易</div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="metric-value text-info" id="validationStrategiesCount">-</div>
                                                <div class="metric-label">验证交易</div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="metric-value text-muted" id="totalStrategiesCount">-</div>
                                                <div class="metric-label">总策略数</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 注释：策略进化配置已整合到四层进化系统配置中 -->

                        <!-- 🔥 四层进化系统配置 -->
                        <div class="config-section">
                            <h3>🚀 四层策略进化系统配置</h3>
                            
                            <!-- 层级数量配置 -->
                            <div class="tier-config-group">
                                <h4>📊 层级数量配置</h4>
                                <div class="config-grid">
                                    <div class="config-item">
                                        <label for="high_freq_pool_size">高频池大小</label>
                                        <input type="number" id="high_freq_pool_size" name="high_freq_pool_size" min="100" max="5000" step="100">
                                        <small>第2层：参与高频进化的策略数量</small>
                            </div>
                                    <div class="config-item">
                                        <label for="display_strategies_count">前端显示数量</label>
                                        <input type="number" id="display_strategies_count" name="display_strategies_count" min="10" max="50" step="1">
                                        <small>第3层：前端页面显示的策略数量</small>
                                    </div>
                                    <div class="config-item">
                                        <label for="real_trading_count">实盘交易数量</label>
                                        <input type="number" id="real_trading_count" name="real_trading_count" min="1" max="10" step="1">
                                        <small>第4层：符合条件的实盘交易策略数量</small>
                                </div>
                            </div>
                        </div>

                            <!-- 🔧 统一进化频率配置 -->
                            <div class="tier-config-group">
                                <h4>⏰ 统一进化频率配置</h4>
                                <p><small>🎯 已删除重复的传统进化间隔配置，统一使用Modern Strategy Manager的四层配置</small></p>
                                <div class="config-grid">
                                    <div class="config-item">
                                        <label for="low_freq_interval_hours">策略池进化间隔 (小时)</label>
                                        <input type="number" id="low_freq_interval_hours" name="low_freq_interval_hours" min="6" max="72" step="6">
                                        <small>第1层：全部策略低频进化间隔</small>
                                    </div>
                                    <div class="config-item">
                                        <label for="high_freq_interval_minutes">高频池进化间隔 (分钟)</label>
                                        <input type="number" id="high_freq_interval_minutes" name="high_freq_interval_minutes" min="10" max="180" step="10">
                                        <small>第2层：高频池策略进化间隔</small>
                                    </div>
                                    <div class="config-item">
                                        <label for="display_interval_minutes">前端显示进化间隔 (分钟)</label>
                                        <input type="number" id="display_interval_minutes" name="display_interval_minutes" min="1" max="30" step="1">
                                        <small>第3层：前端策略持续进化间隔</small>
                                    </div>
                                </div>
                                    </div>

                            <!-- 策略淘汰配置 -->
                            <div class="tier-config-group">
                                <h4>⚡ 策略淘汰配置</h4>
                                <div class="config-grid">
                                    <div class="config-item">
                                        <label for="minScore">淘汰评分阈值 (分)</label>
                                        <input type="number" id="minScore" name="minScore" min="5" max="50" step="5">
                                        <small>低于此评分的策略将被淘汰（当前：10分）</small>
                                    </div>
                                    <div class="config-item">
                                        <label for="eliminationDays">淘汰检查周期 (天)</label>
                                        <input type="number" id="eliminationDays" name="eliminationDays" min="1" max="30" step="1">
                                        <small>每隔几天检查一次淘汰条件</small>
                                    </div>
                                </div>
                                    </div>

                                                        <!-- 🔥 统一验证交易配置 -->
                            <div class="tier-config-group">
                                <h4>🔬 统一验证交易配置</h4>
                                <p><small>🎯 进化本质就是参数修改，无论是自动进化还是手动调整，都使用统一的验证机制</small></p>
                                <div class="config-grid">
                                    <div class="config-item">
                                        <label for="unified_validation_count">统一验证交易次数</label>
                                        <input type="number" id="unified_validation_count" name="unified_validation_count" min="2" max="8" step="1">
                                        <small>所有参数调整后的验证交易次数（高分策略=4次，中等=3次，低分=2次）</small>
                                    </div>
                                    <div class="config-item">
                                        <label for="validation_score_threshold_high">高分策略门槛</label>
                                        <input type="number" id="validation_score_threshold_high" name="validation_score_threshold_high" min="70" max="90" step="5">
                                        <small>80分以上策略使用4次验证交易</small>
                                    </div>
                                    <div class="config-item">
                                        <label for="validation_score_threshold_mid">中等策略门槛</label>
                                        <input type="number" id="validation_score_threshold_mid" name="validation_score_threshold_mid" min="50" max="80" step="5">
                                        <small>60分以上策略使用3次验证交易</small>
                                </div>
                            </div>
                        </div>

                            <!-- 交易金额配置 -->
                            <div class="tier-config-group">
                                <h4>💰 交易金额配置</h4>
                                <div class="config-grid">
                                    <div class="config-item">
                                        <label for="validation_amount">验证交易金额 (USDT)</label>
                                        <input type="number" id="validation_amount" name="validation_amount" min="10" max="200" step="10">
                                        <small>验证交易的单笔金额</small>
                            </div>
                                    <div class="config-item">
                                        <label for="real_trading_amount">实盘交易金额 (USDT)</label>
                                        <input type="number" id="real_trading_amount" name="real_trading_amount" min="50" max="1000" step="50">
                                        <small>实盘交易的单笔金额</small>
                                    </div>
                                    <div class="config-item">
                                        <label for="real_trading_score_threshold">实盘交易评分门槛</label>
                                        <input type="number" id="real_trading_score_threshold" name="real_trading_score_threshold" min="50" max="90" step="5">
                                        <small>策略进入实盘交易的最低评分</small>
                                    </div>
                                    </div>
                                </div>

                            <!-- 🔧 新增：实盘交易控制参数 -->
                            <div class="tier-config-group">
                                <h4>🎯 实盘交易控制参数</h4>
                                <div class="config-grid">
                                    <div class="config-item">
                                        <label for="real_trading_enabled">启用实盘交易</label>
                                        <select id="real_trading_enabled" name="real_trading_enabled">
                                            <option value="false">禁用</option>
                                            <option value="true">启用</option>
                                        </select>
                                        <small>全局实盘交易开关</small>
                                    </div>
                                    <div class="config-item">
                                        <label for="min_simulation_days">最少模拟天数</label>
                                        <input type="number" id="min_simulation_days" name="min_simulation_days" min="1" max="30" step="1">
                                        <small>策略进入实盘前的最少模拟交易天数</small>
                                    </div>
                                    <div class="config-item">
                                        <label for="min_sim_win_rate">最低模拟胜率 (%)</label>
                                        <input type="number" id="min_sim_win_rate" name="min_sim_win_rate" min="50" max="95" step="5">
                                        <small>策略进入实盘交易的最低胜率要求</small>
                                    </div>
                                    <div class="config-item">
                                        <label for="min_sim_total_pnl">最低模拟盈利 (USDT)</label>
                                        <input type="number" id="min_sim_total_pnl" name="min_sim_total_pnl" min="0" max="100" step="1">
                                        <small>策略进入实盘交易的最低累计盈利</small>
                                    </div>
                                </div>
                            </div>

                            <!-- 四层系统状态显示 -->
                            <div class="tier-config-group">
                                <h4>📈 四层系统状态</h4>
                                <div class="tier-status-grid">
                                    <div class="tier-status-card">
                                        <div class="tier-header">第1层 - 策略池</div>
                                        <div class="tier-stats">
                                            <span class="stat-item">策略数量: <span id="tier1_count">-</span></span>
                                            <span class="stat-item">理论进化: <span id="tier1_evolutions">-</span>/小时</span>
                                    </div>
                                    </div>
                                    <div class="tier-status-card">
                                        <div class="tier-header">第2层 - 高频池</div>
                                        <div class="tier-stats">
                                            <span class="stat-item">策略数量: <span id="tier2_count">-</span></span>
                                            <span class="stat-item">理论进化: <span id="tier2_evolutions">-</span>/小时</span>
                                </div>
                            </div>
                                    <div class="tier-status-card">
                                        <div class="tier-header">第3层 - 前端显示</div>
                                        <div class="tier-stats">
                                            <span class="stat-item">策略数量: <span id="tier3_count">-</span></span>
                                            <span class="stat-item">理论进化: <span id="tier3_evolutions">-</span>/小时</span>
                        </div>
                            </div>
                                    <div class="tier-status-card">
                                        <div class="tier-header">第4层 - 实盘交易</div>
                                        <div class="tier-stats">
                                            <span class="stat-item">策略数量: <span id="tier4_count">-</span></span>
                                            <span class="stat-item">评分门槛: <span id="tier4_threshold">-</span>分</span>
                                    </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-warning" id="resetManagementConfig">恢复默认</button>
                    <button type="button" class="btn btn-primary" id="saveManagementConfig">保存配置</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 日志查看弹窗 -->
    <div class="modal fade" id="logsModal" tabindex="-1" aria-labelledby="logsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="logsModalLabel">
                        <i class="fas fa-list-alt"></i> 策略日志
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- 日志筛选 -->
                    <div class="row mb-3">
                        <div class="col-md-3">
                            <select class="form-select" id="logTypeFilter">
                                <option value="all">所有日志</option>
                                <option value="evolution">进化日志</option>
                                <option value="validation">验证交易</option>
                                <option value="real_trading">真实交易</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <select class="form-select" id="strategyFilter">
                                <option value="">所有策略</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <input type="date" class="form-control" id="dateFilter">
                        </div>
                        <div class="col-md-3">
                            <button class="btn btn-primary" onclick="applyLogFilters()">
                                <i class="fas fa-search"></i> 筛选
                            </button>
                        </div>
                    </div>
                    
                    <!-- 日志内容 -->
                    <div id="logsContent">
                        <div class="text-center py-5">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-3">正在加载日志...</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary" onclick="exportLogs()">
                        <i class="fas fa-download"></i> 导出
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.2.3/js/bootstrap.bundle.min.js"></script>
    <!-- 量化交易专用JavaScript -->
    <script src="{{ url_for('static', filename='js/quantitative.js') }}"></script>
    
    <script>
        // 量化系统初始化
        let quantitativeSystem;
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('⚡ 量化系统页面开始初始化...');
            
            // 创建量化系统实例
            quantitativeSystem = new QuantitativeSystem();
            window.quantitativeSystem = quantitativeSystem;
            window.app = quantitativeSystem; // 兼容性别名
            
            // 启动状态管理器
            const statusManager = new GlobalStatusManager();
            statusManager.startStatusPolling();
            
            // 立即加载初始数据
            setTimeout(() => {
                if (quantitativeSystem) {
                    console.log('🔄 开始加载初始数据...');
                    quantitativeSystem.loadInitialData();
                }
            }, 500);
            
            console.log('✅ 量化系统初始化完成');
        });
    </script>
</body>
</html> 