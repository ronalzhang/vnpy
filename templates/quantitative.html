<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ê†°ÈïøÁöÑÈáèÂåñÁ≥ªÁªü - ÈáèÂåñ‰∫§Êòì</title>
    <!-- Ê∑ªÂä†favicon -->
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/logo.png') }}">
    <!-- ÊõøÊç¢‰∏∫Êõ¥Á®≥ÂÆöÁöÑCDN -->
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.2.3/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.3.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <!-- ÂºïÁî®ÈáèÂåñ‰∫§Êòì‰∏ìÁî®Ê†∑Âºè -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/quantitative.css') }}">
    <script src="https://cdn.bootcdn.net/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
</head>
<body>
    <header>
        <nav class="navbar navbar-expand-lg" style="background: linear-gradient(135deg, #1677ff, #4096ff);">
            <div class="container-fluid">
                <div class="navbar-content">
                    <!-- Â∑¶‰æßÔºöÂìÅÁâåÂêçÂíåÁ≥ªÁªüÁä∂ÊÄÅ -->
                    <div class="navbar-left">
                        <div class="navbar-brand-group">
                            <a class="navbar-brand" href="/">
                                <i class="fas fa-chart-line"></i>
                                Ê†°ÈïøÁöÑÈáèÂåñÁ≥ªÁªü
                            </a>
                            <div class="system-status">
                                <span class="status-indicator status-offline" id="system-status-indicator"></span>
                                <span id="system-status-text">Á¶ªÁ∫ø</span>
                                <span id="current-time">2025/6/4 05:05:27</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Âè≥‰æßÔºöÂØºËà™ËèúÂçï -->
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link" href="/">
                                <i class="fas fa-home"></i>
                                <span class="nav-link-desktop-text">Â∏ÇÂú∫Êï∞ÊçÆ</span>
                                <span class="nav-link-mobile-text">Â∏ÇÂú∫</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="/quantitative.html">
                                <i class="fas fa-robot"></i>
                                <span class="nav-link-desktop-text">ÈáèÂåñ‰∫§Êòì</span>
                                <span class="nav-link-mobile-text">ÈáèÂåñ</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/arbitrage.html">
                                <i class="fas fa-exchange-alt"></i>
                                <span class="nav-link-desktop-text">Â•óÂà©Á≥ªÁªü</span>
                                <span class="nav-link-mobile-text">Â•óÂà©</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/operations-log.html">
                                <i class="fas fa-list-alt"></i>
                                <span class="nav-link-desktop-text">Êìç‰ΩúÊó•Âøó</span>
                                <span class="nav-link-mobile-text">Êó•Âøó</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <div class="container-fluid mt-4">
        <!-- Á≥ªÁªüÁä∂ÊÄÅÊ†è -->
        <div class="row mb-3">
            <div class="col-12">
                <div class="card border-0 shadow-sm bg-gradient">
                    <div class="card-body py-2">
                        <div class="row align-items-center">
                            <!-- üî• Áªü‰∏ÄÂÖ®Â±ÄÁä∂ÊÄÅÊåáÁ§∫Âô® -->
                            <div class="col-md-3">
                                <div class="d-flex align-items-center">
                                    <div class="status-indicator me-2" id="globalStatusIndicator">
                                        <span class="status-dot bg-secondary"></span>
                                    </div>
                                    <div>
                                        <small class="text-muted">Á≥ªÁªüÁä∂ÊÄÅ</small>
                                        <div class="fw-bold" id="globalSystemStatus">Ê£ÄÊü•‰∏≠...</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ÂÆûÊó∂Êï∞ÊçÆËøûÊé•Áä∂ÊÄÅ -->
                            <div class="col-md-3">
                                <div class="d-flex align-items-center">
                                    <div class="status-indicator me-2" id="websocketStatusIndicator">
                                        <span class="status-dot bg-warning"></span>
                                    </div>
                                    <div>
                                        <small class="text-muted">ÂÆûÊó∂ËøûÊé•</small>
                                        <div class="fw-bold" id="websocketStatus">ËøûÊé•‰∏≠...</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ‰∫§ÊòìÊâÄËøûÊé•Áä∂ÊÄÅ -->
                            <div class="col-md-3">
                                <div class="d-flex align-items-center">
                                    <div class="status-indicator me-2" id="exchangeStatusIndicator">
                                        <span class="status-dot bg-info"></span>
                                    </div>
                                    <div>
                                        <small class="text-muted">‰∫§ÊòìÊâÄAPI</small>
                                        <div class="fw-bold" id="exchangeStatus">Ê£ÄÊü•‰∏≠...</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Á≠ñÁï•ËøõÂåñÁä∂ÊÄÅ -->
                            <div class="col-md-3">
                                <div class="d-flex align-items-center">
                                    <div class="status-indicator me-2" id="evolutionStatusIndicator">
                                        <span class="status-dot bg-primary"></span>
                                    </div>
                                    <div>
                                        <small class="text-muted">Á≠ñÁï•ËøõÂåñ</small>
                                        <div class="fw-bold" id="evolutionStatus">ËøêË°å‰∏≠...</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ‰ºòÂåñÂêéÁöÑÁ≠ñÁï•ËøõÂåñÊªöÂä®Êó•Âøó -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <h6 class="mb-0">
                            <i class="fas fa-chart-line me-2"></i>Á≠ñÁï•ËøõÂåñÂÆûÊó∂ÁõëÊéß
                        </h6>
                        <div class="d-flex align-items-center">
                            <span class="badge bg-light text-primary me-2" id="evolutionLogCount">0 Êù°ËÆ∞ÂΩï</span>
                            <button class="btn btn-sm btn-outline-light" onclick="showAllLogs()">
                                <i class="fas fa-list me-1"></i>Êü•ÁúãÂÖ®ÈÉ®
                            </button>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <!-- Â¢ûÂº∫ÁöÑÊªöÂä®Êó•ÂøóÊòæÁ§∫ -->
                        <div class="evolution-ticker-container" style="height: 120px; overflow: hidden; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);">
                            <div class="evolution-ticker" id="evolutionTicker">
                                <div class="ticker-item">
                                    <span class="text-muted">Ê≠£Âú®Âä†ËΩΩÁ≠ñÁï•ËøõÂåñÊó•Âøó...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- È°∂ÈÉ®ÊéßÂà∂Èù¢Êùø -->
        <div class="row mb-4">
            <!-- Á≥ªÁªüÊéßÂà∂Âè∞ -->
            <div class="col-md-4 mb-3">
                <div class="card system-control-card h-100">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="fas fa-cog"></i> Á≥ªÁªüÊéßÂà∂Âè∞
                        </h5>
                        
                        <!-- Á≥ªÁªüÁä∂ÊÄÅ -->
                        <div class="mb-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <span>Á≥ªÁªüÁä∂ÊÄÅ</span>
                                <span id="systemStatus">
                                    <span class="status-indicator status-offline"></span>
                                    Á¶ªÁ∫ø
                                </span>
                            </div>
                        </div>
                        
                        <!-- Á≥ªÁªüÂêØÂÅúÊéßÂà∂ -->
                        <div class="mb-3" data-system="quantitative">
                            <div class="d-flex justify-content-between align-items-center">
                                <span>ÈáèÂåñÁ≥ªÁªü</span>
                                <button id="systemToggle" class="btn-toggle" onclick="toggleSystem()">
                                </button>
                            </div>
                        </div>
                        
                        <!-- Ëá™Âä®‰∫§ÊòìÂºÄÂÖ≥ -->
                        <div class="mb-3" data-system="auto-trading">
                            <div class="d-flex justify-content-between align-items-center">
                                <span>ÁúüÂÆû‰∫§Êòì</span>
                                <button id="autoTradingToggle" class="btn-toggle" onclick="toggleAutoTrading()">
                                </button>
                            </div>
                        </div>
                        
                        <!-- Á≠ñÁï•ÁÆ°ÁêÜ -->
                        <div class="mb-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <span>Á≠ñÁï•ÁÆ°ÁêÜ</span>
                                <button class="btn btn-sm btn-outline-light" onclick="showStrategyManagement()">
                                    <i class="fas fa-cogs"></i> ÈÖçÁΩÆ
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Ë¥¶Êà∑ÊÄªËßà -->
            <div class="col-md-4 mb-3">
                <div class="card account-card h-100">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="fas fa-wallet"></i> Ë¥¶Êà∑ÊÄªËßà
                        </h5>
                        
                        <div class="row text-center">
                            <div class="col-6">
                                <div class="metric-value" id="totalBalance">-</div>
                                <div class="metric-label">ÊÄªËµÑ‰∫ß</div>
                            </div>
                            <div class="col-6">
                                <div class="metric-value text-success" id="dailyPnl">-</div>
                                <div class="metric-label">‰ªäÊó•Áõà‰∫è</div>
                            </div>
                        </div>
                        
                        <hr style="border-color: rgba(255,255,255,0.3);">
                        
                        <div class="row text-center">
                            <div class="col-6">
                                <div class="metric-value" id="dailyReturn">-</div>
                                <div class="metric-label">‰ªäÊó•Êî∂ÁõäÁéá</div>
                            </div>
                            <div class="col-6">
                                <div class="metric-value" id="dailyTrades">-</div>
                                <div class="metric-label">‰ªäÊó•‰∫§Êòì</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ‰∫§ÊòìÊâÄÁä∂ÊÄÅ -->
            <div class="col-md-4 mb-3">
                <div class="card exchange-card h-100">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="fas fa-link"></i> ‰∫§ÊòìÊâÄÁä∂ÊÄÅ
                        </h5>
                        
                        <div id="exchangeStatus">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span>
                                    <span class="status-indicator status-online"></span>
                                    Â∏ÅÂÆâ (Binance)
                                </span>
                                <small>25ms</small>
                            </div>
                            
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span>APIÊùÉÈôê</span>
                                <span class="badge bg-success">Áé∞Ë¥ß‰∫§Êòì</span>
                            </div>
                            
                            <div class="d-flex justify-content-between align-items-center">
                                <span>ÊúÄÂêéÊõ¥Êñ∞</span>
                                <small id="lastUpdate">ÂàöÂàö</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Á≠ñÁï•ÁÆ°ÁêÜ -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-brain"></i> ÈáèÂåñÁ≠ñÁï•ÁÆ°ÁêÜ
                        </h5>
                        <div class="d-flex align-items-center">
                            <!-- Á≠ñÁï•ËøõÂåñÊªöÂä®Êó•Âøó -->
                            <div class="evolution-log-container me-3">
                                <div class="evolution-log-header">
                                    <i class="fas fa-chart-line text-primary me-1"></i>
                                    <small class="text-muted">Á≠ñÁï•ËøõÂåñÊó•Âøó</small>
                                </div>
                                <div class="evolution-log-content" id="evolutionLog">
                                    <div class="evolution-log-ticker" id="evolutionTicker">
                                        <!-- ÊªöÂä®Êó•ÂøóÂÜÖÂÆπÂ∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÂä†ËΩΩ -->
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex gap-2">
                                <button class="btn btn-outline-info btn-sm" onclick="showAllLogs()" title="Êü•ÁúãÂÖ®ÈÉ®Êó•Âøó">
                                    <i class="fas fa-list"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row" id="strategiesContainer">
                            <!-- Á≠ñÁï•Âç°ÁâáÂ∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÁîüÊàê -->
                            <div class="col-12">
                                <div class="alert alert-warning" id="jsTestStatus">
                                    üîß Ê≠£Âú®ÊµãËØïJavaScriptÊâßË°å...
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ÂÆûÊó∂ÁõëÊéß -->
        <div class="row mb-4">
            <!-- ÊåÅ‰ªìÁõëÊéß -->
            <div class="col-md-6 mb-3">
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="fas fa-coins"></i> ÂΩìÂâçÊåÅ‰ªì
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>‰∫§ÊòìÂØπ</th>
                                        <th>Êï∞Èáè</th>
                                        <th>Âùá‰ª∑</th>
                                        <th>ÊµÆÁõà</th>
                                    </tr>
                                </thead>
                                <tbody id="positionsTable">
                                    <tr>
                                        <td colspan="4" class="text-center text-muted">ÊöÇÊó†ÊåÅ‰ªì</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ‰∫§Êòì‰ø°Âè∑ -->
            <div class="col-md-6 mb-3">
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="fas fa-signal"></i> ÊúÄÊñ∞‰ø°Âè∑
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Êó∂Èó¥</th>
                                        <th>‰∫§ÊòìÂØπ</th>
                                        <th>‰ø°Âè∑</th>
                                        <th>ÁΩÆ‰ø°Â∫¶</th>
                                    </tr>
                                </thead>
                                <tbody id="signalsTable">
                                    <tr>
                                        <td colspan="4" class="text-center text-muted">ÊöÇÊó†‰ø°Âè∑</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Êî∂ÁõäÊõ≤Á∫øÂõæ -->
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="fas fa-chart-line"></i> Êî∂ÁõäÊõ≤Á∫ø
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="performance-chart">
                            <canvas id="performanceChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h6 class="mb-0">
                            <i class="fas fa-chart-area"></i> ËµÑ‰∫ßÂ¢ûÈïøÂéÜÁ®ã
                        </h6>
                        <div>
                            <button class="btn btn-sm btn-outline-primary" onclick="app.toggleBalanceChart('30')">30Â§©</button>
                            <button class="btn btn-sm btn-outline-primary active" onclick="app.toggleBalanceChart('90')">90Â§©</button>
                            <button class="btn btn-sm btn-outline-primary" onclick="app.toggleBalanceChart('365')">1Âπ¥</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="balance-chart">
                            <canvas id="balanceChart"></canvas>
                        </div>
                        
                        <!-- ÈáåÁ®ãÁ¢ëÂ±ïÁ§∫ -->
                        <div class="milestones mt-3">
                            <div class="row text-center">
                                <div class="col-4">
                                    <div class="milestone-item">
                                        <div class="milestone-value text-success">10U</div>
                                        <div class="milestone-label">Ëµ∑ÂßãËµÑÈáë</div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="milestone-item">
                                        <div class="milestone-value text-warning" id="currentBalance">9.7U</div>
                                        <div class="milestone-label">ÂΩìÂâçËµÑ‰∫ß</div>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="milestone-item">
                                        <div class="milestone-value text-primary">100,000U</div>
                                        <div class="milestone-label">ÁõÆÊ†áËµÑ‰∫ß</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Á≠ñÁï•ÈÖçÁΩÆÂºπÁ™óÊ®°ÊÄÅÊ°Ü -->
    <div class="modal fade" id="strategyConfigModal" tabindex="-1" aria-labelledby="strategyConfigModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="strategyConfigModalLabel">
                        <i class="fas fa-cog"></i> Á≠ñÁï•ÈÖçÁΩÆ
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="strategyConfigForm">
                        <input type="hidden" id="strategyId" name="strategyId">
                        
                        <!-- Âü∫Êú¨‰ø°ÊÅØ -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="strategyName" class="form-label">Á≠ñÁï•ÂêçÁß∞</label>
                                <input type="text" class="form-control" id="strategyName" name="strategyName" required>
                            </div>
                            <div class="col-md-6">
                                <label for="strategySymbol" class="form-label">‰∫§ÊòìÂØπ</label>
                                <select class="form-select" id="strategySymbol" name="strategySymbol" required>
                                    <option value="BTC/USDT">BTC/USDT</option>
                                    <option value="ETH/USDT">ETH/USDT</option>
                                    <option value="ADA/USDT">ADA/USDT</option>
                                    <option value="SOL/USDT">SOL/USDT</option>
                                    <option value="DOGE/USDT">DOGE/USDT</option>
                                    <option value="XRP/USDT">XRP/USDT</option>
                                </select>
                            </div>
                        </div>

                        <!-- Á≠ñÁï•Á±ªÂûã -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="strategyType" class="form-label">Á≠ñÁï•Á±ªÂûã</label>
                                <select class="form-select" id="strategyType" name="strategyType" disabled>
                                    <option value="momentum">Âä®ÈáèÁ≠ñÁï•</option>
                                    <option value="mean_reversion">ÂùáÂÄºÂõûÂΩí</option>
                                    <option value="breakout">Á™ÅÁ†¥Á≠ñÁï•</option>
                                    <option value="grid_trading">ÁΩëÊ†º‰∫§Êòì</option>
                                    <option value="high_frequency">È´òÈ¢ë‰∫§Êòì</option>
                                    <option value="trend_following">Ë∂ãÂäøË∑üË∏™</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="strategyEnabled" class="form-label">Á≠ñÁï•Áä∂ÊÄÅ</label>
                                <div class="form-check form-switch mt-2">
                                    <input class="form-check-input" type="checkbox" role="switch" id="strategyEnabled" name="strategyEnabled">
                                    <label class="form-check-label" for="strategyEnabled">ÂêØÁî®Á≠ñÁï•</label>
                                </div>
                            </div>
                        </div>

                        <!-- Á≠ñÁï•ÂèÇÊï∞ -->
                        <div class="card mb-3">
                            <div class="card-header">
                                <h6 class="mb-0">Á≠ñÁï•ÂèÇÊï∞</h6>
                            </div>
                            <div class="card-body">
                                <div id="strategyParameters">
                                    <!-- Âä®ÊÄÅÂèÇÊï∞Ë°®ÂçïÂ∞ÜÂú®ËøôÈáåÁîüÊàê -->
                                </div>
                            </div>
                        </div>

                        <!-- Á≠ñÁï•ÁªüËÆ° -->
                        <div class="card mb-3">
                            <div class="card-header">
                                <h6 class="mb-0">Á≠ñÁï•ÁªüËÆ°</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="text-center">
                                            <div class="h5 mb-1" id="strategyTotalReturn">-</div>
                                            <small class="text-muted">ÊÄªÊî∂ÁõäÁéá</small>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="text-center">
                                            <div class="h5 mb-1" id="strategyWinRate">-</div>
                                            <small class="text-muted">ÊàêÂäüÁéá</small>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="text-center">
                                            <div class="h5 mb-1" id="strategyTotalTrades">-</div>
                                            <small class="text-muted">‰∫§ÊòìÊ¨°Êï∞</small>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="text-center">
                                            <div class="h5 mb-1" id="strategyDailyReturn">-</div>
                                            <small class="text-muted">Êó•Êî∂ÁõäÁéá</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ÂèñÊ∂à</button>
                    <button type="button" class="btn btn-primary" id="saveStrategyConfig">‰øùÂ≠òÈÖçÁΩÆ</button>
                    <button type="button" class="btn btn-warning" id="resetStrategyParams">ÈáçÁΩÆÂèÇÊï∞</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Á≠ñÁï•Êó•ÂøóÂºπÁ™ó -->
    <div class="modal fade" id="strategyLogsModal" tabindex="-1" aria-labelledby="strategyLogsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="strategyLogsModalLabel">
                        <i class="fas fa-history"></i> Á≠ñÁï•Êó•Âøó
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Êó•ÂøóÁ±ªÂûãÈÄâÊã© -->
                    <ul class="nav nav-tabs mb-3" id="logsTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="trade-logs-tab" data-bs-toggle="tab" data-bs-target="#trade-logs" type="button" role="tab">
                                <i class="fas fa-exchange-alt"></i> ‰∫§ÊòìÊó•Âøó
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="optimization-logs-tab" data-bs-toggle="tab" data-bs-target="#optimization-logs" type="button" role="tab">
                                <i class="fas fa-wrench"></i> ‰ºòÂåñËÆ∞ÂΩï
                            </button>
                        </li>
                    </ul>

                    <div class="tab-content" id="logsTabContent">
                        <!-- ‰∫§ÊòìÊó•Âøó -->
                        <div class="tab-pane fade show active" id="trade-logs" role="tabpanel">
                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <thead>
                                        <tr>
                                            <th>Êó∂Èó¥</th>
                                            <th>‰ø°Âè∑</th>
                                            <th>‰ª∑Ê†º</th>
                                            <th>Êï∞Èáè</th>
                                            <th>ÁΩÆ‰ø°Â∫¶</th>
                                            <th>‰∫§ÊòìÁ±ªÂûã</th>
                                            <th>ÊâßË°åÁä∂ÊÄÅ</th>
                                            <th>Áõà‰∫è</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tradeLogsTable">
                                        <tr>
                                            <td colspan="8" class="text-center text-muted">ÊöÇÊó†‰∫§ÊòìËÆ∞ÂΩï</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <!-- ‰∫§ÊòìÊó•ÂøóÂàÜÈ°µÊéß‰ª∂ -->
                            <div id="tradeLogPaginationContainer" class="mt-3">
                                <!-- ÂàÜÈ°µÊåâÈíÆÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                            </div>
                        </div>

                        <!-- ‰ºòÂåñËÆ∞ÂΩï -->
                        <div class="tab-pane fade" id="optimization-logs" role="tabpanel">
                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <thead>
                                        <tr>
                                            <th>Êó∂Èó¥</th>
                                            <th>‰ºòÂåñÁ±ªÂûã</th>
                                            <th>‰øÆÊîπÂâçÂèÇÊï∞</th>
                                            <th>‰øÆÊîπÂêéÂèÇÊï∞</th>
                                            <th>Ëß¶ÂèëÂéüÂõ†</th>
                                            <th>ÁõÆÊ†áÊàêÂäüÁéá</th>
                                        </tr>
                                    </thead>
                                    <tbody id="optimizationLogsTable">
                                        <tr>
                                            <td colspan="6" class="text-center text-muted">ÊöÇÊó†‰ºòÂåñËÆ∞ÂΩï</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <!-- ÂàÜÈ°µÊéß‰ª∂ -->
                            <div id="logPaginationContainer" class="mt-3">
                                <!-- ÂàÜÈ°µÊåâÈíÆÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ÂÖ≥Èó≠</button>
                    <button type="button" class="btn btn-info" id="exportLogs">ÂØºÂá∫Êó•Âøó</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Á≠ñÁï•ÁÆ°ÁêÜÈÖçÁΩÆÂºπÁ™ó -->
    <div class="modal fade" id="strategyManagementModal" tabindex="-1" aria-labelledby="strategyManagementModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="strategyManagementModalLabel">
                        <i class="fas fa-cogs"></i> Á≠ñÁï•ÁÆ°ÁêÜÈÖçÁΩÆ
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="strategyManagementForm">
                        <!-- ÂÖ®Ëá™Âä®Á≠ñÁï•ÁÆ°ÁêÜ -->
                        <div class="card mb-3">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="fas fa-robot"></i> ÂÖ®Ëá™Âä®Á≠ñÁï•ÁÆ°ÁêÜ
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <div>
                                        <strong>ÂêØÁî®ÂÖ®Ëá™Âä®Á≠ñÁï•ÁÆ°ÁêÜ</strong>
                                        <p class="text-muted mb-0 small">Ëá™Âä®ÈÄâÊã©„ÄÅÂêØÁî®„ÄÅËΩÆÊç¢Âíå‰ºòÂåñÁ≠ñÁï•ÔºåÂÆûÁé∞ÂÖ®Ëá™Âä®ÈáèÂåñ‰∫§Êòì</p>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" role="switch" id="autoManagementEnabled">
                                        <label class="form-check-label" for="autoManagementEnabled">
                                            <span id="autoManagementStatus" class="text-muted">Á¶ÅÁî®</span>
                                        </label>
                                    </div>
                                </div>
                                
                                <div id="autoManagementConfig" style="display: none;">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label for="minActiveStrategies" class="form-label">ÊúÄÂ∞ëÊ¥ªË∑ÉÁ≠ñÁï•Êï∞</label>
                                            <input type="number" class="form-control" id="minActiveStrategies" value="2" min="1" max="10">
                                            <div class="form-text">Á≥ªÁªüËá™Âä®‰øùÊåÅÁöÑÊúÄÂ∞ëËøêË°åÁ≠ñÁï•Êï∞Èáè</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="maxActiveStrategies" class="form-label">ÊúÄÂ§öÊ¥ªË∑ÉÁ≠ñÁï•Êï∞</label>
                                            <input type="number" class="form-control" id="maxActiveStrategies" value="5" min="2" max="20">
                                            <div class="form-text">Á≥ªÁªüÂêåÊó∂ËøêË°åÁöÑÊúÄÂ§öÁ≠ñÁï•Êï∞Èáè</div>
                                        </div>
                                    </div>
                                    <div class="row mt-3">
                                        <div class="col-md-6">
                                            <label for="autoEnableThreshold" class="form-label">Ëá™Âä®ÂêØÁî®Èó®Êßõ</label>
                                            <input type="number" class="form-control" id="autoEnableThreshold" value="45" min="20" max="80" step="0.1">
                                            <div class="form-text">Á≠ñÁï•ËææÂà∞Ê≠§ÂàÜÂÄºËá™Âä®ÂêØÁî®È™åËØÅ‰∫§Êòì</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="autoSelectionInterval" class="form-label">ÈÄâÊã©Ê£ÄÊü•Èó¥Èöî (ÂàÜÈíü)</label>
                                            <input type="number" class="form-control" id="autoSelectionInterval" value="10" min="5" max="60">
                                            <div class="form-text">Ëá™Âä®Ê£ÄÊü•ÂíåÈÄâÊã©Á≠ñÁï•ÁöÑÈó¥ÈöîÊó∂Èó¥</div>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="strategyRotationEnabled" checked>
                                            <label class="form-check-label" for="strategyRotationEnabled">
                                                ÂêØÁî®Á≠ñÁï•ËΩÆÊç¢Êú∫Âà∂
                                            </label>
                                        </div>
                                        <div class="form-text">Ëá™Âä®ÊõøÊç¢Ë°®Áé∞‰∏ç‰Ω≥ÁöÑÁ≠ñÁï•‰∏∫Êõ¥‰ºòÁßÄÁöÑÁ≠ñÁï•</div>
                                    </div>
                                    
                                    <!-- ÂÆûÊó∂Áä∂ÊÄÅÊòæÁ§∫ -->
                                    <div class="mt-4 p-3 bg-light rounded">
                                        <h6 class="mb-2">
                                            <i class="fas fa-chart-pie"></i> ÂΩìÂâçÁä∂ÊÄÅ
                                        </h6>
                                        <div class="row text-center">
                                            <div class="col-md-3">
                                                <div class="metric-value" id="currentActiveStrategies">-</div>
                                                <div class="metric-label">Ê¥ªË∑ÉÁ≠ñÁï•</div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="metric-value text-success" id="realTradingStrategiesCount">-</div>
                                                <div class="metric-label">ÁúüÂÆû‰∫§Êòì</div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="metric-value text-info" id="validationStrategiesCount">-</div>
                                                <div class="metric-label">È™åËØÅ‰∫§Êòì</div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="metric-value text-muted" id="totalStrategiesCount">-</div>
                                                <div class="metric-label">ÊÄªÁ≠ñÁï•Êï∞</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Á≠ñÁï•ËøõÂåñÈÖçÁΩÆ -->
                        <div class="card mb-3">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="fas fa-dna"></i> Á≠ñÁï•ËøõÂåñÈÖçÁΩÆ
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="evolutionInterval" class="form-label">ËøõÂåñÊõ¥Êñ∞Èó¥Èöî (ÂàÜÈíü)</label>
                                        <input type="number" class="form-control" id="evolutionInterval" value="10" min="1" max="60">
                                        <div class="form-text">Á≠ñÁï•Ëá™Âä®ËøõÂåñÂíåÂàõÂª∫Êñ∞Á≠ñÁï•ÁöÑÈó¥ÈöîÊó∂Èó¥</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="maxStrategies" class="form-label">ÊúÄÂ§ßÁ≠ñÁï•Êï∞Èáè</label>
                                        <input type="number" class="form-control" id="maxStrategies" value="20" min="5" max="100">
                                        <div class="form-text">Á≥ªÁªüÂêåÊó∂ËøêË°åÁöÑÊúÄÂ§ßÁ≠ñÁï•Êï∞Èáè</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Á≠ñÁï•Ê†áÂáÜÈÖçÁΩÆ -->
                        <div class="card mb-3">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="fas fa-trophy"></i> Á≠ñÁï•‰∫§ÊòìÊ†áÂáÜ
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4">
                                        <label for="realTradingScore" class="form-label">ÁúüÂÆû‰∫§ÊòìÂàÜÂÄºÈó®Êßõ</label>
                                        <input type="number" class="form-control" id="realTradingScore" value="65" min="50" max="100" step="0.1">
                                        <div class="form-text">Á≠ñÁï•ËææÂà∞Ê≠§ÂàÜÂÄºËá™Âä®ËøõË°åÁúüÂÆû‰∫§Êòì</div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="realTradingCount" class="form-label">ÁúüÂÆû‰∫§ÊòìÁ≠ñÁï•Êï∞Èáè</label>
                                        <input type="number" class="form-control" id="realTradingCount" value="2" min="1" max="10">
                                        <div class="form-text">ÂºÄÂêØÁúüÂÆû‰∫§ÊòìÊó∂ÈÄâÊã©ÂâçÂá†ÂêçÁ≠ñÁï•</div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="validationAmount" class="form-label">È™åËØÅ‰∫§ÊòìÈáëÈ¢ù (USDT)</label>
                                        <input type="number" class="form-control" id="validationAmount" value="50" min="10" max="500" step="10">
                                        <div class="form-text">Á≠ñÁï•È™åËØÅ‰∫§ÊòìÁöÑÂçïÁ¨îÈáëÈ¢ù</div>
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-md-4">
                                        <label for="minTrades" class="form-label">ÊúÄÂ∞ë‰∫§ÊòìÊ¨°Êï∞</label>
                                        <input type="number" class="form-control" id="minTrades" value="10" min="1" max="100">
                                        <div class="form-text">Á≠ñÁï•ËøõÂÖ•ÁúüÂÆû‰∫§ÊòìÁöÑÊúÄÂ∞ë‰∫§ÊòìÊ¨°Êï∞</div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="minWinRate" class="form-label">ÊúÄ‰ΩéËÉúÁéá (%)</label>
                                        <input type="number" class="form-control" id="minWinRate" value="65" min="50" max="95" step="0.1">
                                        <div class="form-text">Á≠ñÁï•ËøõÂÖ•ÁúüÂÆû‰∫§ÊòìÁöÑÊúÄ‰ΩéËÉúÁéáË¶ÅÊ±Ç</div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="realTradingAmount" class="form-label">ÁúüÂÆû‰∫§ÊòìÈáëÈ¢ù (USDT)</label>
                                        <input type="number" class="form-control" id="realTradingAmount" value="100" min="50" max="1000" step="10">
                                        <div class="form-text">ÁúüÂÆû‰∫§ÊòìÁöÑÂçïÁ¨î‰∫§ÊòìÈáëÈ¢ù</div>
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-md-4">
                                        <label for="minProfit" class="form-label">ÊúÄ‰ΩéÊî∂Áõä (USDT)</label>
                                        <input type="number" class="form-control" id="minProfit" value="0" min="0" step="0.01">
                                        <div class="form-text">Á≠ñÁï•ËøõÂÖ•ÁúüÂÆû‰∫§ÊòìÁöÑÊúÄ‰ΩéÊÄªÊî∂Áõä</div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="maxDrawdown" class="form-label">ÊúÄÂ§ßÂõûÊí§ (%)</label>
                                        <input type="number" class="form-control" id="maxDrawdown" value="10" min="1" max="50" step="0.1">
                                        <div class="form-text">Á≠ñÁï•ÂÖÅËÆ∏ÁöÑÊúÄÂ§ßÂõûÊí§Áéá</div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="minSharpeRatio" class="form-label">ÊúÄ‰ΩéÂ§èÊôÆÊØîÁéá</label>
                                        <input type="number" class="form-control" id="minSharpeRatio" value="1.0" min="0" max="5" step="0.1">
                                        <div class="form-text">Á≠ñÁï•ÁöÑÊúÄ‰ΩéÂ§èÊôÆÊØîÁéáË¶ÅÊ±Ç</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- È£éÈô©ÁÆ°ÁêÜÈÖçÁΩÆ -->
                        <div class="card mb-3">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="fas fa-shield-alt"></i> È£éÈô©ÁÆ°ÁêÜÈÖçÁΩÆ
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4">
                                        <label for="maxPositionSize" class="form-label">ÊúÄÂ§ß‰ªì‰Ωç (USDT)</label>
                                        <input type="number" class="form-control" id="maxPositionSize" value="100" min="10" max="10000" step="10">
                                        <div class="form-text">Âçï‰∏™Á≠ñÁï•ÁöÑÊúÄÂ§ß‰ªì‰ΩçÈáëÈ¢ù</div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="stopLossPercent" class="form-label">Ê≠¢ÊçüÁôæÂàÜÊØî (%)</label>
                                        <input type="number" class="form-control" id="stopLossPercent" value="5" min="1" max="20" step="0.1">
                                        <div class="form-text">ÂÖ®Â±ÄÊ≠¢ÊçüËß¶ÂèëÁöÑ‰∫èÊçüÁôæÂàÜÊØî</div>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="takeProfitPercent" class="form-label">Ê≠¢ÁõàÁôæÂàÜÊØî (%)</label>
                                        <input type="number" class="form-control" id="takeProfitPercent" value="4" min="1" max="15" step="0.1">
                                        <div class="form-text">ÂÖ®Â±ÄÊ≠¢ÁõàËß¶ÂèëÁöÑÁõàÂà©ÁôæÂàÜÊØî</div>
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-md-6">
                                        <label for="maxHoldingMinutes" class="form-label">ÊúÄÂ§ßÊåÅ‰ªìÊó∂Èó¥ (ÂàÜÈíü)</label>
                                        <input type="number" class="form-control" id="maxHoldingMinutes" value="30" min="5" max="120" step="5">
                                        <div class="form-text">Ë∂ÖËøáÊ≠§Êó∂Èó¥‰∏îÊúâÁõàÂà©Â∞ÜËß¶ÂèëÊó∂Èó¥Ê≠¢Áõà</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="minProfitForTimeStop" class="form-label">Êó∂Èó¥Ê≠¢ÁõàÊúÄ‰ΩéÊî∂Áõä (%)</label>
                                        <input type="number" class="form-control" id="minProfitForTimeStop" value="1" min="0.1" max="5" step="0.1">
                                        <div class="form-text">Êó∂Èó¥Ê≠¢ÁõàËß¶ÂèëÁöÑÊúÄ‰ΩéÊî∂ÁõäÁéá</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Á≠ñÁï•Ê∑òÊ±∞ÈÖçÁΩÆ -->
                        <div class="card mb-3">
                            <div class="card-header">
                                <h6 class="mb-0">
                                    <i class="fas fa-trash-alt"></i> Á≠ñÁï•Ê∑òÊ±∞ÈÖçÁΩÆ
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="eliminationDays" class="form-label">Ê∑òÊ±∞Âë®Êúü (Â§©)</label>
                                        <input type="number" class="form-control" id="eliminationDays" value="7" min="1" max="30">
                                        <div class="form-text">Á≠ñÁï•Ë°®Áé∞ËØÑ‰º∞ÂíåÊ∑òÊ±∞ÁöÑÂë®Êúü</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="minScore" class="form-label">ÊúÄ‰ΩéËØÑÂàÜ</label>
                                        <input type="number" class="form-control" id="minScore" value="50" min="0" max="100" step="0.1">
                                        <div class="form-text">Á≠ñÁï•‰øùÁïôÁöÑÊúÄ‰ΩéËØÑÂàÜÊ†áÂáÜ</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ÂèñÊ∂à</button>
                    <button type="button" class="btn btn-warning" id="resetManagementConfig">ÊÅ¢Â§çÈªòËÆ§</button>
                    <button type="button" class="btn btn-primary" id="saveManagementConfig">‰øùÂ≠òÈÖçÁΩÆ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // üîß ÈÄêÊ≠•ÊµãËØïQuantitativeSystemÈóÆÈ¢ò
        setTimeout(() => {
            const testEl = document.getElementById('jsTestStatus');
            if (testEl) {
                testEl.innerHTML = '‚úÖ Âü∫Á°ÄJSÊ≠£Â∏∏ÔºÅÊ≠£Âú®Ê£ÄÊü•quantitative.js...';
                testEl.className = 'alert alert-info';
                
                // ÊµãËØïÊñá‰ª∂Âä†ËΩΩ
                setTimeout(() => {
                    if (typeof QuantitativeSystem === 'undefined') {
                        testEl.innerHTML = '‚ùå QuantitativeSystemÁ±ªÊú™ÂÆö‰πâÔºÅquantitative.jsÊñá‰ª∂Âä†ËΩΩÂ§±Ë¥•';
                        testEl.className = 'alert alert-danger';
                        
                        // Â∞ùËØïÊâãÂä®Âä†ËΩΩÊñá‰ª∂ËøõË°åË∞ÉËØï
                        const script = document.createElement('script');
                        script.src = '/static/js/quantitative.js';
                        script.onload = () => {
                            testEl.innerHTML = 'üîÑ quantitative.jsÊâãÂä®Âä†ËΩΩÂÆåÊàêÔºåÈáçÊñ∞Ê£ÄÊü•...';
                            setTimeout(() => {
                                if (typeof QuantitativeSystem !== 'undefined') {
                                    testEl.innerHTML = '‚úÖ ÊâãÂä®Âä†ËΩΩÊàêÂäüÔºÅÂàõÂª∫ÂÆû‰æã...';
                                    try {
                                        window.app = new QuantitativeSystem();
                                        testEl.innerHTML = 'üéâ ÊàêÂäüÔºÅÂºÄÂßãÂä†ËΩΩÁ≠ñÁï•Êï∞ÊçÆ...';
                                        testEl.className = 'alert alert-success';
                                        window.app.loadStrategies();
                                    } catch (error) {
                                        testEl.innerHTML = `‚ùå ÂàõÂª∫ÂÆû‰æãÂ§±Ë¥•: ${error.message}`;
                                        testEl.className = 'alert alert-danger';
                                    }
                                } else {
                                    testEl.innerHTML = '‚ùå ÊâãÂä®Âä†ËΩΩ‰πüÂ§±Ë¥•Ôºåquantitative.jsÊúâËØ≠Ê≥ïÈîôËØØ';
                                    testEl.className = 'alert alert-danger';
                                }
                            }, 1000);
                        };
                        script.onerror = () => {
                            testEl.innerHTML = '‚ùå quantitative.jsÊñá‰ª∂Êó†Ê≥ïÂä†ËΩΩÔºåË∑ØÂæÑÊàñÊùÉÈôêÈóÆÈ¢ò';
                            testEl.className = 'alert alert-danger';
                        };
                        document.head.appendChild(script);
                    } else {
                        testEl.innerHTML = '‚úÖ QuantitativeSystemÁ±ªÂ≠òÂú®ÔºÅÂàõÂª∫ÂÆû‰æã...';
                        testEl.className = 'alert alert-success';
                        setTimeout(() => {
                            try {
                                window.app = new QuantitativeSystem();
                                testEl.innerHTML = 'üéâ ÂÆû‰æãÂàõÂª∫ÊàêÂäüÔºÅÂºÄÂßãÂä†ËΩΩÁ≠ñÁï•Êï∞ÊçÆ...';
                                window.app.loadStrategies();
                            } catch (error) {
                                testEl.innerHTML = `‚ùå ÂàõÂª∫ÂÆû‰æãÂ§±Ë¥•: ${error.message}`;
                                testEl.className = 'alert alert-danger';
                            }
                        }, 1000);
                    }
                }, 1000);
            }
        }, 500);
    </script>
    <script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.2.3/js/bootstrap.bundle.min.js"></script>
    <script>
        // Êõ¥Êñ∞ÂΩìÂâçÊó∂Èó¥
        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            });
            const timeElement = document.getElementById('current-time');
            if (timeElement) {
                timeElement.textContent = timeString;
            }
        }

        // È°µÈù¢Âä†ËΩΩÊó∂Á´ãÂç≥Êõ¥Êñ∞Êó∂Èó¥
        updateCurrentTime();
        
        // ÊØèÁßíÊõ¥Êñ∞Êó∂Èó¥
        setInterval(updateCurrentTime, 1000);
    </script>
    <script src="{{ url_for('static', filename='js/quantitative.js') }}"></script>
    <script>
        // üî• ÂÖ®Â±ÄÂèòÈáèÂ£∞ÊòéÔºàÂøÖÈ°ªÂú®ÂàùÂßãÂåñ‰πãÂâçÔºå‰ΩÜÈÅøÂÖçÈáçÂ§çÂ£∞ÊòéÔºâ
        // systemRunning Â∑≤Âú® quantitative.js ‰∏≠Â£∞Êòé
        let autoTradingEnabled = false;
        let refreshTimer = null;
        let evolutionLogTimer = null;
        let managementConfig = {};
        
        // ‚úÖ Á°Æ‰øùappÊòØÂÖ®Â±ÄÂèòÈáè
        window.app = null;
        var app = null; // Áî®‰∫éonclick‰∫ã‰ª∂ÁöÑÁõ¥Êé•ÂÖ®Â±ÄÂèòÈáè
        
        // üî• Áªü‰∏ÄÁöÑÂ∫îÁî®ÂàùÂßãÂåñÂáΩÊï∞
        function initializeApp() {
            console.log('üöÄ ÂºÄÂßãÂàùÂßãÂåñÈáèÂåñ‰∫§ÊòìÁ≥ªÁªü...');
            
            // Ê£ÄÊü•QuantitativeSystemÁ±ªÊòØÂê¶Â≠òÂú®
            if (typeof QuantitativeSystem === 'undefined') {
                console.error('‚ùå QuantitativeSystemÁ±ªÊú™ÂÆö‰πâÔºåquantitative.jsÂèØËÉΩÊ≤°ÊúâÊ≠£Á°ÆÂä†ËΩΩ');
                return false;
            }
            
            try {
                // üî• ÂàõÂª∫ÂÖ®Â±ÄappÂÆû‰æã
                window.app = new QuantitativeSystem();
                // üî• ÂêåÊó∂ËÆæÁΩÆ‰∏∫Áõ¥Êé•ÂÖ®Â±ÄÂèòÈáèÔºåÂÖºÂÆπonclick‰∫ã‰ª∂
                app = window.app;
                console.log('‚úÖ ÈáèÂåñ‰∫§ÊòìÁ≥ªÁªüÂÆû‰æãÂàõÂª∫ÊàêÂäü');
                
                // Á´ãÂç≥Âä†ËΩΩÊï∞ÊçÆ
                window.app.loadSystemStatus();
                window.app.loadStrategies();
                window.app.loadAccountInfo();
                window.app.loadPositions();
                window.app.loadSignals();
                
                // ÁªëÂÆöÁ≠ñÁï•ÁÆ°ÁêÜÈÖçÁΩÆÊåâÈíÆ‰∫ã‰ª∂
                bindManagementConfigEvents();
                
                return true;
            } catch (error) {
                console.error(`‚ùå ÈáèÂåñ‰∫§ÊòìÁ≥ªÁªüÂàùÂßãÂåñÂ§±Ë¥•: ${error.message}`, error);
                return false;
            }
        }
        
        // üî• ÁªëÂÆöÁ≠ñÁï•ÁÆ°ÁêÜÈÖçÁΩÆÊåâÈíÆ‰∫ã‰ª∂
        function bindManagementConfigEvents() {
            // Á≠ñÁï•ÁÆ°ÁêÜÈÖçÁΩÆÊåâÈíÆ
            const managementBtn = document.querySelector('button[onclick="showStrategyManagement()"]');
            if (managementBtn) {
                managementBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    showStrategyManagement();
                });
            }
            
            // ‰øùÂ≠òÈÖçÁΩÆÊåâÈíÆ
            const saveBtn = document.getElementById('saveManagementConfig');
            if (saveBtn) {
                saveBtn.addEventListener('click', function() {
                    if (window.app) {
                        window.app.saveManagementConfig();
                    }
                });
            }
            
            // ÈáçÁΩÆÈÖçÁΩÆÊåâÈíÆ
            const resetBtn = document.getElementById('resetManagementConfig');
            if (resetBtn) {
                resetBtn.addEventListener('click', function() {
                    if (window.app) {
                        window.app.resetManagementConfig();
                    }
                });
            }
        }
        
        // DOMÂä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            // Âª∂Ëøü‰∏ÄÁÇπÁ°Æ‰øùquantitative.jsÂÆåÂÖ®Âä†ËΩΩ
            setTimeout(() => {
                const success = initializeApp();
                
                // Âú®È°µÈù¢‰∏äÊòæÁ§∫ÂàùÂßãÂåñÁä∂ÊÄÅ
                const testEl = document.getElementById('jsTestStatus');
                if (testEl) {
                    if (success) {
                        testEl.innerHTML = 'üéâ Â∫îÁî®ÂàùÂßãÂåñÊàêÂäüÔºÅÁ≥ªÁªüÊ≠£Â∏∏ËøêË°å';
                        testEl.className = 'alert alert-success';
                        // 3ÁßíÂêéÈöêËóèÊµãËØï‰ø°ÊÅØ
                        setTimeout(() => {
                            testEl.style.display = 'none';
                        }, 3000);
                    } else {
                        testEl.innerHTML = '‚ùå Â∫îÁî®ÂàùÂßãÂåñÂ§±Ë¥•ÔºåËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï';
                        testEl.className = 'alert alert-danger';
                    }
                }
            }, 1000);
        });
        
        // üî• ÂÖ®Â±ÄÂáΩÊï∞ÂÆö‰πâ - Á°Æ‰øùÊâÄÊúâonclick‰∫ã‰ª∂ÈÉΩËÉΩÊ≠£Á°ÆÂ∑•‰Ωú
        window.toggleSystem = function() {
            if (window.app) {
                window.app.toggleSystem();
            } else {
                console.error('‚ùå appÂØπË±°Êú™ÂàùÂßãÂåñ');
            }
        };
        
        window.toggleAutoTrading = function() {
            if (window.app) {
                window.app.toggleAutoTrading();
            } else {
                console.error('‚ùå appÂØπË±°Êú™ÂàùÂßãÂåñ');
            }
        };
        
        window.refreshStrategies = function() {
            if (window.app) {
                window.app.loadStrategies();
            } else {
                console.error('‚ùå appÂØπË±°Êú™ÂàùÂßãÂåñ');
            }
        };
        
        window.showStrategyManagement = function() {
            if (window.app) {
                window.app.loadManagementConfig();
                const modal = new bootstrap.Modal(document.getElementById('strategyManagementModal'));
                modal.show();
            } else {
                console.error('‚ùå appÂØπË±°Êú™ÂàùÂßãÂåñ');
            }
        };
        
        window.showAllLogs = function() {
            if (window.app && window.app.allEvolutionLogs) {
                // ÂàùÂßãÂåñÂàÜÈ°µÂèòÈáè
                window.app.logsCurrentPage = 1;
                window.app.logsPerPage = 20;
                
                // ÂàõÂª∫ÂÖ®ÈÉ®Êó•ÂøóÊ®°ÊÄÅÊ°Ü
                const modalHtml = `
                <div class="modal fade" id="allLogsModal" tabindex="-1">
                <div class="modal-dialog modal-xl">
                <div class="modal-content">
                <div class="modal-header">
                <h5 class="modal-title">
                <i class="fas fa-list me-2"></i>ÊâÄÊúâÁ≠ñÁï•ËøõÂåñÊó•Âøó
                <span class="badge bg-primary ms-2" id="logsTotal">ÂÖ± ${window.app.allEvolutionLogs.length} Êù°</span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                <div class="table-responsive">
                <table class="table table-hover">
                <thead>
                <tr><th style="width: 20%">Êó∂Èó¥</th><th style="width: 15%">Êìç‰Ωú</th><th style="width: 65%">ËØ¶ÊÉÖ</th></tr>
                </thead>
                <tbody id="allLogsTableBody"></tbody>
                </table>
                </div>
                <!-- ÂàÜÈ°µÊéß‰ª∂ -->
                <div class="row mt-3">
                    <div class="col-md-6">
                        <div class="d-flex align-items-center">
                            <span class="text-muted me-3" id="pageInfo">Á¨¨1È°µÔºåÂÖ±1È°µ</span>
                            <span class="text-muted" id="recordInfo">ÊòæÁ§∫Á¨¨1-15Êù°ÔºåÂÖ±0Êù°ËÆ∞ÂΩï</span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <nav>
                            <ul class="pagination justify-content-end mb-0">
                                <li class="page-item" id="prevPage">
                                    <a class="page-link" href="#" onclick="changeLogsPage(window.app.logsCurrentPage - 1)">‰∏ä‰∏ÄÈ°µ</a>
                                </li>
                                <li class="page-item active" id="currentPageItem">
                                    <span class="page-link" id="currentPageSpan">1</span>
                                </li>
                                <li class="page-item" id="nextPage">
                                    <a class="page-link" href="#" onclick="changeLogsPage(window.app.logsCurrentPage + 1)">‰∏ã‰∏ÄÈ°µ</a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
                </div>
                <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ÂÖ≥Èó≠</button>
                </div>
                </div>
                </div>
                </div>`;
                
                // Âà†Èô§Â∑≤Â≠òÂú®ÁöÑÊ®°ÊÄÅÊ°Ü
                const existingModal = document.getElementById('allLogsModal');
                if (existingModal) existingModal.remove();
                
                // Ê∑ªÂä†Êñ∞Ê®°ÊÄÅÊ°ÜÂπ∂ÊòæÁ§∫
                document.body.insertAdjacentHTML('beforeend', modalHtml);
                
                // Ê∏≤ÊüìÊó•ÂøóÊï∞ÊçÆ
                renderLogsPage();
                
                const modal = new bootstrap.Modal(document.getElementById('allLogsModal'));
                modal.show();
            } else {
                console.log('ÊöÇÊó†Êó•ÂøóÊï∞ÊçÆ');
            }
        };
        
        // Ê∏≤ÊüìÊó•ÂøóÂàÜÈ°µÊï∞ÊçÆ
        window.renderLogsPage = function() {
            if (!window.app || !window.app.allEvolutionLogs) return;
            
            const tbody = document.getElementById('allLogsTableBody');
            if (!tbody) return;
            
            // ‰øÆÂ§çÊéíÂ∫èÔºöÁ°Æ‰øùÊúÄÊñ∞Êó•ÂøóÂú®ÂâçÈù¢
            const allLogs = [...window.app.allEvolutionLogs].sort((a, b) => {
                const timeA = new Date(a.timestamp || '1970-01-01').getTime();
                const timeB = new Date(b.timestamp || '1970-01-01').getTime();
                return timeB - timeA; // ÈôçÂ∫èÊéíÂàóÔºåÊúÄÊñ∞Âú®Ââç
            });
            
            // ËÆ°ÁÆóÂàÜÈ°µ
            const totalLogs = allLogs.length;
            const totalPages = Math.ceil(totalLogs / window.app.logsPerPage);
            const startIndex = (window.app.logsCurrentPage - 1) * window.app.logsPerPage;
            const endIndex = Math.min(startIndex + window.app.logsPerPage, totalLogs);
            const currentPageLogs = allLogs.slice(startIndex, endIndex);
            
            // Ê∏≤ÊüìË°®Ê†ºÊï∞ÊçÆ
            tbody.innerHTML = currentPageLogs.map(log => {
                const time = new Date(log.timestamp).toLocaleString('zh-CN');
                let actionClass = 'secondary';
                let actionText = 'ÂèòÊõ¥';
                
                switch(log.action) {
                    case 'created':
                        actionClass = 'success';
                        actionText = 'Êñ∞Â¢û';
                        break;
                    case 'eliminated':
                        actionClass = 'danger';
                        actionText = 'Ê∑òÊ±∞';
                        break;
                    case 'optimized':
                        actionClass = 'primary';
                        actionText = '‰ºòÂåñ';
                        break;
                    case 'updated':
                        actionClass = 'info';
                        actionText = 'Êõ¥Êñ∞';
                        break;
                    case 'promoted':
                        actionClass = 'warning';
                        actionText = 'ÊôãÁ∫ß';
                        break;
                    case 'protected':
                        actionClass = 'info';
                        actionText = '‰øùÊä§';
                        break;
                    case 'evolved':
                        actionClass = 'primary';
                        actionText = 'ËøõÂåñ';
                        break;
                }
                
                return `
                    <tr>
                        <td class="text-muted">${time}</td>
                        <td><span class="badge bg-${actionClass}">${actionText}</span></td>
                        <td>${log.details}</td>
                    </tr>
                `;
            }).join('');
            
            // Êõ¥Êñ∞ÂàÜÈ°µ‰ø°ÊÅØ
            const pageInfo = document.getElementById('pageInfo');
            const recordInfo = document.getElementById('recordInfo');
            const currentPageSpan = document.getElementById('currentPageSpan');
            const prevPage = document.getElementById('prevPage');
            const nextPage = document.getElementById('nextPage');
            
            if (pageInfo) pageInfo.textContent = `Á¨¨${window.app.logsCurrentPage}È°µÔºåÂÖ±${totalPages}È°µ`;
            if (recordInfo) recordInfo.textContent = `ÊòæÁ§∫Á¨¨${startIndex + 1}-${endIndex}Êù°ÔºåÂÖ±${totalLogs}Êù°ËÆ∞ÂΩï`;
            if (currentPageSpan) currentPageSpan.textContent = window.app.logsCurrentPage;
            
            // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
            if (prevPage) {
                if (window.app.logsCurrentPage <= 1) {
                    prevPage.classList.add('disabled');
                } else {
                    prevPage.classList.remove('disabled');
                }
            }
            
            if (nextPage) {
                if (window.app.logsCurrentPage >= totalPages) {
                    nextPage.classList.add('disabled');
                } else {
                    nextPage.classList.remove('disabled');
                }
            }
        };
        
        // ÂàáÊç¢Êó•ÂøóÈ°µÈù¢
        window.changeLogsPage = function(page) {
            if (!window.app || !window.app.allEvolutionLogs) return;
            
            const totalPages = Math.ceil(window.app.allEvolutionLogs.length / window.app.logsPerPage);
            
            if (page < 1 || page > totalPages) return;
            
            window.app.logsCurrentPage = page;
            renderLogsPage();
        };
        
        // Á°Æ‰øùappÂØπË±°‰∏≠ÁöÑÊñπÊ≥ï‰πüËÉΩË¢´ÂÖ®Â±ÄËÆøÈóÆ
        window.app = window.app || {};
        
    </script>
    <!-- ÂÆûÊó∂ÁõëÊéßËÑöÊú¨ -->
    <script src="/static/js/real_time_monitor.js"></script>
</body>
</html> 